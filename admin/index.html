<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ø§Ù„Ù‚Ù†ÙˆØ§Øª</title>
<style>
body{font-family:tahoma;background:#111;color:#fff;margin:0;padding:20px}
h1{text-align:center}
table{width:100%;border-collapse:collapse;margin-top:20px}
th,td{border:1px solid #444;padding:8px;text-align:center}
th{background:#222}
input,select,button{padding:6px;border-radius:5px;border:0}
button{cursor:pointer}
.add{background:#28a745;color:#fff}
.save{background:#007bff;color:#fff}
.del{background:#dc3545;color:#fff}
</style>
</head>
<body>

<h1>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù‚Ù†ÙˆØ§Øª</h1>

<button class="add" onclick="addRow()">â• Ø¥Ø¶Ø§ÙØ© Ù‚Ù†Ø§Ø©</button>

<table id="table">
<thead>
<tr>
<th>ID</th>
<th>Ø§Ù„Ø§Ø³Ù…</th>
<th>Ø§Ù„Ø±Ø§Ø¨Ø·</th>
<th>Ø§Ù„Ù‚Ø³Ù…</th>
<th>Ø­Ø°Ù</th>
</tr>
</thead>
<tbody></tbody>
</table>

<br>
<button class="save" onclick="save()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>

<script>
let channels = {};

async function load(){
  const r = await fetch('/api/channels');
  channels = await r.json();
  render();
}

function render(){
  const tbody = document.querySelector("#table tbody");
  tbody.innerHTML = '';
  Object.keys(channels).forEach(cat=>{
    channels[cat].forEach(ch=>{
      tbody.innerHTML += row(ch,cat);
    })
  })
}

function row(ch,cat){
  return `<tr>
  <td><input value="${ch.id}"></td>
  <td><input value="${ch.name}"></td>
  <td><input value="${ch.url}" style="width:100%"></td>
  <td><input value="${cat}"></td>
  <td><button class="del" onclick="this.parentElement.parentElement.remove()">âŒ</button></td>
  </tr>`
}

function addRow(){
  document.querySelector("#table tbody").innerHTML += row({id:'',name:'',url:''},'');
}

async function save(){
  const rows = document.querySelectorAll("tbody tr");
  let data = {};
  rows.forEach(r=>{
    const t = r.querySelectorAll("input");
    const id = t[0].value;
    const name = t[1].value;
    const url = t[2].value;
    const cat = t[3].value || "Other";
    if(!data[cat]) data[cat]=[];
    data[cat].push({id,name,url,category:cat});
  });

  await fetch('/api/save',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify(data)
  });

  alert("ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­ âœ…");
}

load();
</script>
</body>
</html>
